<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.3">
<title>traction API documentation</title>
<meta name="description" content="">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Package <code>traction</code></h1>
</header>
<section id="section-intro">
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="traction.traction"><code class="flex name class">
<span>class <span class="ident">traction</span></span>
<span>(</span><span>target)</span>
</code></dt>
<dd>
<div class="desc"><p><strong>init</strong> takes the db target either as string or dbcq object.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class traction:

    #def __init__(self, target):
    #    self.db = dbcq(target)
    external_sampleid_type = &#34;...&#34;
    sampleid_type = &#34;...&#34;

    def __init__(self, target):
        &#34;&#34;&#34;__init__ takes the db target either as string or dbcq object.&#34;&#34;&#34;
        # pass a string argument to dbcq
        if isinstance(target, str):
            self.db = dbcq(target)
        elif isinstance(target, dbcq): # use dbcq instance directly
            self.db = target
        else:
            raise Exception(&#34;target needs to be string or dbcq instance&#34;)
        
    #get(&#34;sample&#34;, &#34;samplelocation.locationpath = &#39;dresden&#39;&#34;)
    # get pspawn samples with patients, wobei, das waer schon fast unabhaengig von centraxx db
    # a|b ist nur moeglich, wenn maximal ein fk aus b a referenziert, sonst error
    #get(&#34;sample.patientcontainer|idcontainer.psn, sample|sampleidcontainer.psn&#34;, where=&#34;idcontainer like &#39;pspawn&#39; and sampleidcontainer.idcontainertype=6&#34;)
    
    
    def sample(self, sampleids=None, extsampleids=None, verbose=False):
        &#34;&#34;&#34;sample gets sample(s) by sampleid or external id. pass sampleids as array. to join in more information, say verbose=True, this is slower than non-verbose.&#34;&#34;&#34;

        # ids used in query
        queryids = []
        
        # set the idcontainer type we search for
        if not sampleids == None:
            idcontainertype = 6
            queryids = sampleids
        if not extsampleids == None:
            idcontainertype = 7
            queryids = extsampleid
            
        psnwhere = &#34;in &#34; + traction._sqlinplaceholder(len(queryids))

        # todo for verbose and non-verbose: incorporate where locationpath (and like)? like this: (see smpl in dump.txt)
        &#34;&#34;&#34;
        if queryids != None:
            # query = query + &#34; and &#34; + self._whereparam(&#34;sidc.psn&#34;, like=like)
            query = query + f&#34; and sidc.psn {psnwhere} &#34;
            args.append(queryids)
        if locationpath != None:
            query = query + &#34; and &#34; + self._whereparam(&#34;samplelocation.locationpath&#34;, like=like)
            args.append(locationpath)
        &#34;&#34;&#34;
        
        if not verbose:
            # a non-verbose query (quicker)
            query = f&#34;select s.*, c.psn as &#39;sampleidcontainer.psn&#39; from centraxx_sample s inner join centraxx_sampleidcontainer as c on c.sample = s.oid where c.idcontainertype = {idcontainertype} and c.psn {psnwhere}&#34;
            
        else:
            # a verbose query (slower)
            # we would like to be able to return the column names prefixed by the table names, to avoid clashes when column names appear in more than one table. unfortunately there seems to be no standard sql way of doing this, see https://stackoverflow.com/a/57832920
            # so for now say: select &lt;table short&gt;.&lt;column name&gt; as &#39;&lt;table name&gt;.&lt;column name&gt;&#39;

            # use left joins to return something if a value is null
            query = f&#34;&#34;&#34;
            select s.*,
            sidc.psn as &#39;sampleidcontainer.psn&#39;,
            samplelocation.locationid as &#39;samplelocation.locationid&#39;, 
            samplelocation.locationpath as &#39;samplelocation.locationpath&#39;,
            sampletype.code as &#39;sampletype.code&#39;,
            stockprocessing.code as &#39;stockprocessing.code&#39;,
            secondprocessing.code as &#39;secondprocessing.code&#39;,
            project.code as &#39;project.code&#39;,
            receptable.code as &#39;receptable.code&#39;,
            orgunit.code as &#39;orgunit.code&#39;,
            flexistudy.code as &#39;flexistudy.code&#39;
            from centraxx_sample s
            inner join centraxx_sampleidcontainer as sidc on sidc.sample = s.oid
            left join centraxx_samplelocation samplelocation on samplelocation.oid = s.samplelocation
            left join centraxx_sampletype as sampletype on sampletype.oid = s.sampletype
            left join centraxx_stockprocessing as stockprocessing on s.stockprocessing = stockprocessing.oid
            left join centraxx_stockprocessing as secondprocessing on s.secondprocessing = secondprocessing.oid
            left join centraxx_project as project on s.project = project.oid
            left join centraxx_samplereceptable as receptable on s.receptable = receptable.oid
            left join centraxx_organisationunit as orgunit on s.orgunit = orgunit.oid
            left join centraxx_flexistudy as flexistudy on s.flexistudy = flexistudy.oid
            
            where sidc.idcontainertype = {idcontainertype}
            and sidc.psn {psnwhere}
            &#34;&#34;&#34;
            
        result = self.db.qfad(query, queryids) 

        return result

    def _sqlinplaceholder(n):
        &#34;&#34;&#34;_sqlinplaceholder returns a string like (?, ?, ?, ? ...) with n question marks for sql in&#34;&#34;&#34;
        # put this in a package sqlutil?

        out = &#34;(&#34;
        for i in range(n):
            out += &#34;?&#34;
            if i &lt; n - 1:
                out += &#34;,&#34;
        out += &#34;)&#34;
        return out

    def _whereparam(self, name, like:bool=None):
        &#34;&#34;&#34;_wherestring gives a ?-parameterized sql where expression for name equal or like parameter for use in queries&#34;&#34;&#34;

        if like == None or like == False:
            return name + &#34; = ?&#34;
        else:
            return name + &#34; like &#39;%&#39; + ? + &#39;%&#39;&#34;
        

    def patient(self, sampleid:str=None):
        &#34;&#34;&#34;patient gives the patient of sample.&#34;&#34;&#34;
        
        # get from sample to patient psn: sample to patientcontainer, patientcontainer to idcontainer, idcontainer has psn.
        query = &#34;&#34;&#34;
        select idc.psn as &#34;idcontainer.psn&#34;, pc.* from centraxx_idcontainer idc
        inner join centraxx_patientcontainer pc on idc.patientcontainer = pc.oid
        inner join centraxx_sample s on s.patientcontainer = pc.oid
        join centraxx_sampleidcontainer sidc on sidc.sample = s.oid
        where idc.idcontainertype = 8 and sidc.psn = ?
        &#34;&#34;&#34;
        result = self.db.qfad(query, sampleid)
        if len(result) == 0:
            return None
        return result[0]


    def name(self, table:str, code:str=None, lang:str=None, ml_table:str=None):
        &#34;&#34;&#34;name gives the name for a code or a list of names for all codes in a table in de or en.
        table: the name of the centraxx table without centraxx_ prefix
        code: the code
        lang: de|en
        ml_table: if the table connecting to multilingualentry is named different, give it here. eg: name(&#39;laborvaluegroup&#39;, ... ml_name=&#39;labval_grp_ml_name&#39;)&#34;&#34;&#34;

        # interlacing the table name assumes that the referencing pattern for multilingual entries stays the same across table names.
        query = &#34;select [&#34; + table + &#34;].code, multilingual.value as name, multilingual.lang as lang&#34;
        query += &#34; from [centraxx_&#34; + table + &#34;] as [&#34; + table + &#34;]&#34;
        # put together the name for the ml_table
        ml_name = &#34;&#34;
        if ml_table != None: # the name is different
            ml_name = &#34;centraxx_&#34; + ml_table
        else: # the name is the same
            ml_name = &#34;centraxx_&#34; + table + &#34;_ml_name&#34;
        query += &#34; inner join [&#34; + ml_name + &#34;] mlname on mlname.related_oid = [&#34; + table + &#34;].oid&#34;
        query += &#34; inner join centraxx_multilingualentry multilingual on mlname.oid = multilingual.oid&#34;
        
        # restrict the query to specific lang or code if given
        wherestrings = []
        args = []
        if code != None:
            wherestrings.append(self._whereparam(&#34;[&#34; + table + &#34;].code&#34;))
            args.append(code)
        if lang != None:
            wherestrings.append(self._whereparam(&#34;multilingual.lang&#34;))
            args.append(lang)


        # only add sql-where if needed
        if len(wherestrings) &gt; 0:
            query += &#34; where &#34;
            # join where clauses by and
            query += &#34; and &#34;.join(wherestrings)

        # print(query)


        # return the result
        res = self.db.qfad(query, *args)
        return res


    def names_by_codes(self, table:str, lang:str, ml_table:str=None):
        &#34;&#34;&#34;names_by_code returns the multilingual name entries by code for quick access. for params see name()
        e.g.:
        names_by_codes(&#34;laborvalue&#34;, &#34;de&#34;) returns:
        {
          &#34;NUM_STOOL_LAXATIVE&#34;: &#34;Abführmittel&#34;,
          &#34;NUM_NMR_ACETONE_VALUE&#34;: &#34;Aceton&#34;,
          ...
        }
        &#34;&#34;&#34;

        # get the full result
        res = self.name(table, lang=lang, ml_table=ml_table)

        # key by code
        out = {}
        for line in res:
            out[line[&#34;code&#34;]] = line[&#34;name&#34;]
            
        return out</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="traction.traction.external_sampleid_type"><code class="name">var <span class="ident">external_sampleid_type</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="traction.traction.sampleid_type"><code class="name">var <span class="ident">sampleid_type</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="traction.traction.name"><code class="name flex">
<span>def <span class="ident">name</span></span>(<span>self, table: str, code: str = None, lang: str = None, ml_table: str = None)</span>
</code></dt>
<dd>
<div class="desc"><p>name gives the name for a code or a list of names for all codes in a table in de or en.
table: the name of the centraxx table without centraxx_ prefix
code: the code
lang: de|en
ml_table: if the table connecting to multilingualentry is named different, give it here. eg: name('laborvaluegroup', &hellip; ml_name='labval_grp_ml_name')</p></div>
</dd>
<dt id="traction.traction.names_by_codes"><code class="name flex">
<span>def <span class="ident">names_by_codes</span></span>(<span>self, table: str, lang: str, ml_table: str = None)</span>
</code></dt>
<dd>
<div class="desc"><p>names_by_code returns the multilingual name entries by code for quick access. for params see name()
e.g.:
names_by_codes("laborvalue", "de") returns:
{
"NUM_STOOL_LAXATIVE": "Abführmittel",
"NUM_NMR_ACETONE_VALUE": "Aceton",
&hellip;
}</p></div>
</dd>
<dt id="traction.traction.patient"><code class="name flex">
<span>def <span class="ident">patient</span></span>(<span>self, sampleid: str = None)</span>
</code></dt>
<dd>
<div class="desc"><p>patient gives the patient of sample.</p></div>
</dd>
<dt id="traction.traction.sample"><code class="name flex">
<span>def <span class="ident">sample</span></span>(<span>self, sampleids=None, extsampleids=None, verbose=False)</span>
</code></dt>
<dd>
<div class="desc"><p>sample gets sample(s) by sampleid or external id. pass sampleids as array. to join in more information, say verbose=True, this is slower than non-verbose.</p></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="traction.traction" href="#traction.traction">traction</a></code></h4>
<ul class="">
<li><code><a title="traction.traction.external_sampleid_type" href="#traction.traction.external_sampleid_type">external_sampleid_type</a></code></li>
<li><code><a title="traction.traction.name" href="#traction.traction.name">name</a></code></li>
<li><code><a title="traction.traction.names_by_codes" href="#traction.traction.names_by_codes">names_by_codes</a></code></li>
<li><code><a title="traction.traction.patient" href="#traction.traction.patient">patient</a></code></li>
<li><code><a title="traction.traction.sample" href="#traction.traction.sample">sample</a></code></li>
<li><code><a title="traction.traction.sampleid_type" href="#traction.traction.sampleid_type">sampleid_type</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.3</a>.</p>
</footer>
</body>
</html>
